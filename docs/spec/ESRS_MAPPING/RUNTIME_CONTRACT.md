---
DOC_TYPE: SPEC
CAPABILITY: ESRS_MAPPING
COMPONENT: mapping
FUNCTION_LABEL: "Map GS1 standards to ESRS"
OWNER: gs1ned-isa
STATUS: active
LAST_VERIFIED: 2026-02-12
VERIFICATION_METHOD: manual
---

# ESRS_MAPPING Runtime Contract

## Purpose
Map GS1 standards to ESRS

## Entry Points

<!-- EVIDENCE:implementation:server/routers/esrs-gs1-mapping.ts -->
### API Endpoints (tRPC)
- `server/routers/esrs-gs1-mapping.ts` <!-- EVIDENCE:implementation:server/routers/esrs-gs1-mapping.ts -->
- `server/routers/esrs-roadmap.ts` <!-- EVIDENCE:implementation:server/routers/esrs-roadmap.ts -->
- `server/routers/gap-analyzer.ts` <!-- EVIDENCE:implementation:server/routers/gap-analyzer.ts -->

### Services
- `server/batch-generate-esrs-mappings.ts` <!-- EVIDENCE:implementation:server/batch-generate-esrs-mappings.ts -->
- `server/compliance-scoring.ts` <!-- EVIDENCE:implementation:server/compliance-scoring.ts -->
- `server/create-attribute-mappings.ts` <!-- EVIDENCE:implementation:server/create-attribute-mappings.ts -->

### UI Components
- `client/src/components/ComplianceCoverageChart.tsx`
- `client/src/components/ESRSDatapointsSection.tsx`
- `client/src/pages/AdminAnalyticsDashboard.tsx`

## Inputs/Outputs

### Inputs
**Mapping Generation**
- ESRS datapoints (1,184 from EFRAG IG3)
- GS1 standards catalog (60+ standards)
- AI mapping engine configuration

### Outputs
**ESRS-GS1 Mapping**
```typescript
{
  esrsDatapointId: number,
  gs1StandardId: number,
  relevance: number,  // 0-10 scale
  rationale: string,
  confidence: number,  // 0-100%
  generatedAt: Date
}
```

**Mapping Stats**
```typescript
{
  totalMappings: 450,
  coveragePercent: number,
  avgConfidence: number
}
```

## Invariants

1. **AI-Generated**: All 450+ mappings generated by GPT-4
2. **Confidence Threshold**: Only mappings with >70% confidence included
3. **Bidirectional**: ESRS → GS1 and GS1 → ESRS navigation
4. **Provenance**: All mappings include generation timestamp and model version
5. **Review Required**: All mappings subject to governance review before publication

## Failure Modes

### Observable Signals
- **Low Coverage**: <80% ESRS datapoints mapped
- **Low Confidence**: Avg confidence <70%
- **AI API Failure**: Mapping generation timeout

### Recovery Procedures
- **Low Coverage**: Adjust AI prompts, regenerate
- **Low Confidence**: Manual review and enhancement
- **AI Failure**: Retry with exponential backoff

## Data Dependencies

### Database Tables
- `esrs_datapoints` - 1,184 EFRAG datapoints
- `gs1_standards` - 60+ standards
- `esrs_gs1_mappings` - 450+ AI-generated mappings

### External APIs
- **Manus Forge API** - GPT-4 for mapping generation

## Security/Secrets

### Required Secrets
- `OPENAI_API_KEY` - Mapping generation
- `DATABASE_URL` - TiDB connection

### Authentication
- **Admin Only**: Mapping generation restricted
- **Public Read**: Viewing mappings requires Manus OAuth

## Verification Methods

### Smoke Test
- **Location**: `scripts/probe/esrs_mapping_health.sh`
- **Status**: ⏳ Planned
- **Frequency**: After mapping generation
- **Coverage**: Mapping count, confidence distribution, coverage stats

### Integration Tests
- **Location**: `server/gs1-mapping-engine.test.ts`
- **Coverage**: Mapping generation, confidence scoring, bidirectional links
- **Framework**: Vitest
- **Status**: 85%+ passing

### Manual Verification
- **Admin Dashboard**: `/admin/esrs-gs1-mappings`
- **Metrics**: 450+ mappings, >70% avg confidence, >80% coverage
- Status: ⏳ To be created

### Integration Tests
- (To be documented)

## Evidence

<!-- EVIDENCE:requirement:docs/planning/refactoring/FILE_INVENTORY.json -->
- Phase 0 Inventory: 41 files classified as ESRS_MAPPING
<!-- EVIDENCE:implementation:server/routers/esrs-gs1-mapping.ts -->
- Code entrypoints: 9 identified
<!-- EVIDENCE:decision:docs/planning/refactoring/QUALITY_SCORECARDS.json -->
- Quality grade: C (70/100)

---

**Contract Status:** DRAFT  
**Completeness:** ~30% (skeleton only, needs detailed analysis)  
**Next Steps:** Analyze code to populate all sections
